{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/throttle-debounce/dist/index.esm.js","webpack:///./js/PasteImage.ts","webpack:///./js/PreviewPlugin.ts","webpack:///./js/SidebarPreview.ts","webpack:///./js/PublicPreview.ts","webpack:///./js/editor.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","installedModules","installedCssChunks","2","__webpack_require__","exports","module","l","e","promises","Promise","resolve","reject","href","fullhref","p","existingLinkTags","document","getElementsByTagName","dataHref","tag","getAttribute","rel","existingStyleTags","linkTag","createElement","type","onload","onerror","event","request","target","src","err","Error","code","parentNode","removeChild","appendChild","then","installedChunkData","promise","onScriptComplete","script","charset","timeout","nc","setAttribute","jsonpScriptSrc","error","clearTimeout","chunk","errorType","realSrc","message","name","undefined","setTimeout","head","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","console","jsonpArray","window","oldJsonpFunction","slice","s","throttle","delay","noTrailing","callback","debounceMode","timeoutID","cancelled","lastExec","clearExistingTimeout","wrapper","self","this","elapsed","Date","now","args","arguments","exec","apply","cancel","initialized","listeners","listenForPaste","addEventListener","pasteHandler","init","clipboardData","items","includes","blob","getAsFile","source","getURLObj","createObjectURL","createImage","URL","file","pastedImage","Image","listener","listen","handler","scrollOffsetLines","atBegin","initPromise","offsetMap","scrollMode","preview","text","element","initAceHooks","initPreviewHooks","onpopstate","onHashChange","renderer","renderText","buildOffsetMap","previewOffset","offset","top","find","each","parseInt","dataset","line","$","onScrollEditor","Math","max","floor","index","scrollTop","resetScrollMode","onScrollPreview","previewElement","previewLine","findIndex","session","getLength","aceEditor","scrollToLine","handleImage","image","OC","dialogs","prompt","ok","cursorPos","getCursorPosition","uploadText","finalText","insert","uploadImage","replace","rangeConstructor","row","column","Renderer","textEditorOnHashChange","aceRequire","require","Range","PasteImage","getSession","$blockScrolling","Infinity","on","scroll","initCheckboxHandler","location","hash","substr","checked","getLine","indexOf","doc","path","getCurrentPath","url","linkToRemote","reader","FileReader","deferred","Deferred","onloadend","result","ajax","processData","toString","success","readAsArrayBuffer","OCA","Files_Texteditor","dir","Files","App","fileList","_currentDirectory","handlePreview","model","$thumbnailDiv","$thumbnailContainer","fallback","previewHeight","parent","width","when","getFileContent","getFullPath","content","removeClass","addClass","$textPreview","children","remove","append","css","attach","manager","addPreviewHandler","linkToRemoteBase","shareToken","generateUrl","token","previewPlugin","registerPreviewPlugin","val","publicPreview","PublicPreview","previewRoot","previewFrame","prepend","filePath","querySelector","Plugins","register","SidebarPreview"],"mappings":"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","file":"editor.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t};\n\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded CSS chunks\n \tvar installedCssChunks = {\n \t\t2: 0\n \t}\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t2: 0\n \t};\n\n\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"\" + chunkId + \".editor.js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// mini-css-extract-plugin CSS loading\n \t\tvar cssChunks = {\"0\":1};\n \t\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n \t\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n \t\t\tpromises.push(installedCssChunks[chunkId] = new Promise(function(resolve, reject) {\n \t\t\t\tvar href = \"\" + chunkId + \".styles.css\";\n \t\t\t\tvar fullhref = __webpack_require__.p + href;\n \t\t\t\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n \t\t\t\tfor(var i = 0; i < existingLinkTags.length; i++) {\n \t\t\t\t\tvar tag = existingLinkTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n \t\t\t\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return resolve();\n \t\t\t\t}\n \t\t\t\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n \t\t\t\tfor(var i = 0; i < existingStyleTags.length; i++) {\n \t\t\t\t\tvar tag = existingStyleTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\");\n \t\t\t\t\tif(dataHref === href || dataHref === fullhref) return resolve();\n \t\t\t\t}\n \t\t\t\tvar linkTag = document.createElement(\"link\");\n \t\t\t\tlinkTag.rel = \"stylesheet\";\n \t\t\t\tlinkTag.type = \"text/css\";\n \t\t\t\tlinkTag.onload = resolve;\n \t\t\t\tlinkTag.onerror = function(event) {\n \t\t\t\t\tvar request = event && event.target && event.target.src || fullhref;\n \t\t\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + request + \")\");\n \t\t\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n \t\t\t\t\terr.request = request;\n \t\t\t\t\tdelete installedCssChunks[chunkId]\n \t\t\t\t\tlinkTag.parentNode.removeChild(linkTag)\n \t\t\t\t\treject(err);\n \t\t\t\t};\n \t\t\t\tlinkTag.href = fullhref;\n\n \t\t\t\tvar head = document.getElementsByTagName(\"head\")[0];\n \t\t\t\thead.appendChild(linkTag);\n \t\t\t}).then(function() {\n \t\t\t\tinstalledCssChunks[chunkId] = 0;\n \t\t\t}));\n \t\t}\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonpMarkdown2\"] = window[\"webpackJsonpMarkdown2\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* eslint-disable no-undefined,no-param-reassign,no-shadow */\n\n/**\n * Throttle execution of a function. Especially useful for rate limiting\n * execution of handlers on events like resize and scroll.\n *\n * @param  {Number}    delay          A zero-or-greater delay in milliseconds. For event callbacks, values around 100 or 250 (or even higher) are most useful.\n * @param  {Boolean}   [noTrailing]   Optional, defaults to false. If noTrailing is true, callback will only execute every `delay` milliseconds while the\n *                                    throttled-function is being called. If noTrailing is false or unspecified, callback will be executed one final time\n *                                    after the last throttled-function call. (After the throttled-function has not been called for `delay` milliseconds,\n *                                    the internal counter is reset)\n * @param  {Function}  callback       A function to be executed after delay milliseconds. The `this` context and all arguments are passed through, as-is,\n *                                    to `callback` when the throttled-function is executed.\n * @param  {Boolean}   [debounceMode] If `debounceMode` is true (at begin), schedule `clear` to execute after `delay` ms. If `debounceMode` is false (at end),\n *                                    schedule `callback` to execute after `delay` ms.\n *\n * @return {Function}  A new, throttled, function.\n */\nfunction throttle (delay, noTrailing, callback, debounceMode) {\n  /*\n   * After wrapper has stopped being called, this timeout ensures that\n   * `callback` is executed at the proper times in `throttle` and `end`\n   * debounce modes.\n   */\n  var timeoutID;\n  var cancelled = false; // Keep track of the last time `callback` was executed.\n\n  var lastExec = 0; // Function to clear existing timeout\n\n  function clearExistingTimeout() {\n    if (timeoutID) {\n      clearTimeout(timeoutID);\n    }\n  } // Function to cancel next exec\n\n\n  function cancel() {\n    clearExistingTimeout();\n    cancelled = true;\n  } // `noTrailing` defaults to falsy.\n\n\n  if (typeof noTrailing !== 'boolean') {\n    debounceMode = callback;\n    callback = noTrailing;\n    noTrailing = undefined;\n  }\n  /*\n   * The `wrapper` function encapsulates all of the throttling / debouncing\n   * functionality and when executed will limit the rate at which `callback`\n   * is executed.\n   */\n\n\n  function wrapper() {\n    var self = this;\n    var elapsed = Date.now() - lastExec;\n    var args = arguments;\n\n    if (cancelled) {\n      return;\n    } // Execute `callback` and update the `lastExec` timestamp.\n\n\n    function exec() {\n      lastExec = Date.now();\n      callback.apply(self, args);\n    }\n    /*\n     * If `debounceMode` is true (at begin) this is used to clear the flag\n     * to allow future `callback` executions.\n     */\n\n\n    function clear() {\n      timeoutID = undefined;\n    }\n\n    if (debounceMode && !timeoutID) {\n      /*\n       * Since `wrapper` is being called for the first time and\n       * `debounceMode` is true (at begin), execute `callback`.\n       */\n      exec();\n    }\n\n    clearExistingTimeout();\n\n    if (debounceMode === undefined && elapsed > delay) {\n      /*\n       * In throttle mode, if `delay` time has been exceeded, execute\n       * `callback`.\n       */\n      exec();\n    } else if (noTrailing !== true) {\n      /*\n       * In trailing throttle mode, since `delay` time has not been\n       * exceeded, schedule `callback` to execute `delay` ms after most\n       * recent execution.\n       *\n       * If `debounceMode` is true (at begin), schedule `clear` to execute\n       * after `delay` ms.\n       *\n       * If `debounceMode` is false (at end), schedule `callback` to\n       * execute after `delay` ms.\n       */\n      timeoutID = setTimeout(debounceMode ? clear : exec, debounceMode === undefined ? delay - elapsed : delay);\n    }\n  }\n\n  wrapper.cancel = cancel; // Return the wrapper function.\n\n  return wrapper;\n}\n\n/* eslint-disable no-undefined */\n/**\n * Debounce execution of a function. Debouncing, unlike throttling,\n * guarantees that a function is only executed a single time, either at the\n * very beginning of a series of calls, or at the very end.\n *\n * @param  {Number}   delay         A zero-or-greater delay in milliseconds. For event callbacks, values around 100 or 250 (or even higher) are most useful.\n * @param  {Boolean}  [atBegin]     Optional, defaults to false. If atBegin is false or unspecified, callback will only be executed `delay` milliseconds\n *                                  after the last debounced-function call. If atBegin is true, callback will be executed only at the first debounced-function call.\n *                                  (After the throttled-function has not been called for `delay` milliseconds, the internal counter is reset).\n * @param  {Function} callback      A function to be executed after delay milliseconds. The `this` context and all arguments are passed through, as-is,\n *                                  to `callback` when the debounced-function is executed.\n *\n * @return {Function} A new, debounced function.\n */\n\nfunction debounce (delay, atBegin, callback) {\n  return callback === undefined ? throttle(delay, atBegin, false) : throttle(delay, callback, atBegin !== false);\n}\n\nexport { throttle, debounce };\n","// from https://github.com/redgeoff/paste-image\n\n// This code is heavily based on Joel Basada's great work at\n// http://joelb.me/blog/2011/code-snippet-accessing-clipboard-images-with-javascript/\n\nexport type PasteListener = (image: HTMLImageElement, file: File) => void;\n\nexport class PasteImage {\n    private initialized: boolean = false;\n    private listeners: PasteListener[] = [];\n\n    private listenForPaste() {\n        window.addEventListener('paste', e => {\n            this.pasteHandler(e);\n        });\n    }\n\n    private init() {\n        if (this.initialized) {\n            return;\n        }\n        this.listenForPaste();\n        this.initialized = true;\n    }\n\n    private pasteHandler(e) {\n        if (e.clipboardData && e.clipboardData.items) {\n            // Get the items from the clipboard\n            const items = e.clipboardData.items;\n\n            // Loop through all items, looking for any kind of image\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.includes('image')) {\n                    const blob = items[i].getAsFile();\n\n                    const URLObj = this.getURLObj();\n                    const source = URLObj.createObjectURL(blob);\n\n                    // The URL can then be used as the source of an image\n                    this.createImage(source, blob);\n                }\n            }\n        }\n    }\n\n    private getURLObj() {\n        return window.URL || window['webkitURL'];\n    }\n\n    // Creates a new image from a given source\n    private createImage(source: string, file: File) {\n        const pastedImage = new Image();\n\n        pastedImage.onload = () => {\n            for (const listener of this.listeners) {\n                listener(pastedImage, file);\n            }\n        };\n        pastedImage.src = source;\n    }\n\n    public listen(handler: PasteListener) {\n        this.init();\n        this.listeners.push(handler);\n    }\n}\n","import {Renderer} from './Renderer';\nimport {throttle, debounce} from 'throttle-debounce';\nimport {PasteImage} from './PasteImage';\nimport Thenable = JQuery.Thenable;\nimport TextEditorPreviewPlugin = OCA.Files_Texteditor.TextEditorPreviewPlugin;\n\ndeclare const aceEditor: AceAjax.Editor;\n\ntype onPopstate = (this: Window, ev: PopStateEvent) => any;\n\nconst scrollOffsetLines = 3;\n\nexport class PreviewPlugin implements TextEditorPreviewPlugin {\n    private renderer: Renderer;\n    private rangeConstructor: new (startRow: number, startColumn: number, endRow: number, endColumn: number) => AceAjax.Range;\n\n    private initPromise: Promise<void> | null = null;\n    private textEditorOnHashChange: onPopstate | null;\n    private offsetMap: number[] = [];\n    private session: AceAjax.IEditSession;\n    private previewElement: JQuery;\n    private scrollMode: 'editor' | 'preview' | null = null;\n\n    init() {\n        if (!this.initPromise) {\n            this.initPromise = import('./Renderer').then(({Renderer}) => {\n                this.renderer = new Renderer();\n            }, console.error.bind(console));\n            if (!this.textEditorOnHashChange) {\n                this.textEditorOnHashChange = window.onpopstate;\n            }\n\n            const aceRequire = window['ace']['acequire'] || window['ace'].require;\n            this.rangeConstructor = aceRequire(\"ace/range\").Range;\n\n            new PasteImage().listen(this.handleImage);\n        }\n\n        return this.initPromise;\n    }\n\n    initAceHooks() {\n        if (this.session !== aceEditor.getSession()) {\n            this.session = aceEditor.getSession();\n            aceEditor.$blockScrolling = Infinity;\n            this.session.on(\"changeScrollTop\", this.onScrollEditor);\n        }\n    }\n\n    initPreviewHooks(element) {\n        if (this.previewElement !== element) {\n            this.previewElement = element;\n            this.previewElement.scroll(this.onScrollPreview);\n            this.initCheckboxHandler(element);\n        }\n    }\n\n    onHashChange(e: PopStateEvent) {\n        const hash = window.location.hash.substr(1);\n        if (hash.substr(0, 6) !== 'editor' && this.textEditorOnHashChange) {\n            this.textEditorOnHashChange.call(window, e)\n        }\n    }\n\n    preview = throttle(500, (text: string, element) => {\n        this.initAceHooks();\n        this.initPreviewHooks(element);\n        window.onpopstate = this.onHashChange;\n\n        this.init().then(() => {\n            this.renderer.renderText(text, element).then(() => {\n                setTimeout(() => {\n                    this.buildOffsetMap(element)\n                }, 500);\n            });\n        });\n    });\n\n    initCheckboxHandler(element) {\n        const Range = this.rangeConstructor;\n        const session = this.session;\n        element.on('change', 'input[type=checkbox]', function () {\n            const checked = this.checked;\n            const row = this.dataset.line;\n            const oldText = session.getLine(row);\n            const index = oldText.indexOf('[') + 1;\n            session.replace(new Range(row, index, row, index + 1), checked ? 'x' : ' ');\n            session['$wrapData'].length = session.doc.getLength();\n        });\n    }\n\n    buildOffsetMap = throttle(1000, (element) => {\n        const previewOffset = (element.offset() as { top: number }).top;\n        const offsetMap: number[] = [];\n        element.find('[data-line]').each(function () {\n            offsetMap[parseInt(this.dataset.line, 10)] = ($(this).offset() as { top: number }).top - previewOffset;\n        });\n        this.offsetMap = offsetMap;\n    });\n\n    onScrollEditor = throttle(100, (top: number) => {\n        if (this.scrollMode === 'preview') {\n            return;\n        }\n        this.scrollMode = 'editor';\n        const line = Math.max(0, Math.floor(top / 15) - scrollOffsetLines);\n        const previewOffset = this.offsetMap.find((offset, index) => (typeof offset !== 'undefined') && index >= line);\n        if (typeof previewOffset !== 'undefined') {\n            $('#preview').scrollTop(previewOffset);\n        }\n        this.resetScrollMode();\n    });\n\n    onScrollPreview = throttle(100, () => {\n        if (this.scrollMode === 'editor') {\n            return;\n        }\n        this.scrollMode = 'preview';\n        const top = this.previewElement.scrollTop() as number;\n        const previewLine = this.offsetMap.findIndex(offset => offset >= (top - 1));\n        if (previewLine < this.session.getLength()) {\n            aceEditor.scrollToLine(Math.max(previewLine - scrollOffsetLines, 0), false, true, () => {\n            });\n        }\n        this.resetScrollMode();\n    });\n\n    resetScrollMode = debounce(500, () => {\n        this.scrollMode = null;\n    });\n\n    handleImage = (image: HTMLImageElement, file) => {\n        OC.dialogs.prompt('Enter the name for the image', 'Upload image', (ok, name) => {\n            if (!ok) {\n                return;\n            }\n            const blob = image.src;\n            const cursorPos = aceEditor.getCursorPosition();\n            const uploadText = `![uploading...](${blob})`;\n            const finalText = `![${name}](${name})`;\n            this.session.insert(cursorPos, uploadText);\n            this.uploadImage(name, file).then(() => {\n                this.session.replace(\n                    new this.rangeConstructor(cursorPos.row, cursorPos.column, cursorPos.row, cursorPos.column + uploadText.length),\n                    finalText\n                );\n            });\n\n        }, true, 'image name');\n    };\n\n    uploadImage(name: string, file: File): Thenable<void> {\n        const path = `${this.getCurrentPath()}/${name}`.replace(/\\/\\/+/g, '/');\n        const url = OC.linkToRemote('files' + path);\n        const reader = new FileReader();\n        const deferred = $.Deferred();\n        reader.onloadend = (e) => {\n            if (reader.result) {\n                $.ajax({\n                    url: url,\n                    processData: false,\n                    data: reader.result.toString(),\n                    type: 'PUT',\n                    success: deferred.resolve.bind(deferred),\n                    error: deferred.reject.bind(deferred)\n                });\n            }\n        };\n        reader.readAsArrayBuffer(file);\n        return deferred.promise();\n    }\n\n    getCurrentPath() {\n        if (OCA.Files_Texteditor.file && OCA.Files_Texteditor.file.dir) {\n            return OCA.Files_Texteditor.file.dir;\n        } else if (OCA.Files.App && OCA.Files.App.fileList._currentDirectory) {\n            return OCA.Files.App.fileList._currentDirectory;\n        }\n    }\n}\n","import {Renderer} from \"./Renderer\";\n\nexport class SidebarPreview implements SidebarPreviewPlugin {\n    private renderer: Renderer;\n\n    private initPromise: Promise<void> | null = null;\n\n    init() {\n        if (!this.initPromise) {\n            this.initPromise = import('./Renderer').then(({Renderer}) => {\n                this.renderer = new Renderer(true);\n            });\n        }\n        return this.initPromise;\n    }\n\n    attach(manager) {\n        manager.addPreviewHandler('text/markdown', this.handlePreview);\n    }\n\n    handlePreview: SidebarPreviewRender = (model, $thumbnailDiv, $thumbnailContainer, fallback) => {\n        const previewWidth = ($thumbnailContainer.parent().width() as number) + 50;  // 50px for negative margins\n        const previewHeight = previewWidth / (16 / 9);\n\n        $.when(\n            this.getFileContent(model.getFullPath()),\n            this.init()\n        ).then(([content]) => {\n            $thumbnailDiv.removeClass('icon-loading icon-32');\n            $thumbnailContainer.addClass('large');\n            $thumbnailContainer.addClass('text');\n            const $textPreview = $('<div id=\"preview\" class=\"text-markdown\"/>');\n            this.renderer.renderText(content, $textPreview);\n            $thumbnailDiv.children('.stretcher').remove();\n            $thumbnailDiv.append($textPreview);\n            $thumbnailContainer.css(\"max-height\", previewHeight);\n        }, function () {\n            fallback();\n        });\n    };\n\n    getFileContent(path: string) {\n        const url = OC.linkToRemoteBase('files' + path);\n        return $.get(url);\n    }\n}\n","import {Renderer} from \"./Renderer\";\n\nexport class PublicPreview {\n    private renderer: Renderer;\n\n    private initPromise: Promise<void> | null = null;\n\n    init() {\n        if (!this.initPromise) {\n            this.initPromise = import('./Renderer').then(({Renderer}) => {\n                this.renderer = new Renderer(true);\n            });\n        }\n        return this.initPromise;\n    }\n\n    attach(previewElement: JQuery, shareToken: string) {\n        previewElement\n            .addClass('icon-loading')\n            .children().remove();\n\n        $.when(\n            this.getFileContent(shareToken),\n            this.init()\n        ).then(([content]) => {\n            previewElement\n                .removeClass('icon-loading');\n\n            this.renderer.renderText(content, previewElement);\n        });\n    }\n\n    getFileContent(shareToken: string) {\n        const url = OC.generateUrl('/s/{token}/download', {token: shareToken});\n        return $.get(url);\n    }\n}\n","import {PreviewPlugin} from \"./PreviewPlugin\";\nimport {SidebarPreview} from \"./SidebarPreview\";\nimport {PublicPreview} from \"./PublicPreview\";\n\nconst previewPlugin = new PreviewPlugin();\n\n$(() => {\n\tif (OCA.Files_Texteditor && OCA.Files_Texteditor.registerPreviewPlugin) {\n\t\tOCA.Files_Texteditor.registerPreviewPlugin('text/markdown', previewPlugin);\n\t}\n\n\tif (\n\t\t$('#isPublic').val() &&\n\t\t$('#mimetype').val() === 'text/markdown'\n\t) {\n\t\tconst publicPreview = new PublicPreview();\n\t\tconst previewRoot = $('#preview');\n\t\tpreviewRoot.addClass('text-markdown');\n\t\tconst previewFrame = $('<div class=\"public-preview\"/>');\n\t\tpreviewRoot.prepend(previewFrame);\n\t\tpublicPreview.attach(previewFrame, $('#sharingToken').val() as string);\n\t}\n});\n\n// coerce webpack into loading scripts properly\n__webpack_require__.p = OC.filePath('files_markdown', 'js', '../build/');\nconst script = document.querySelector('[nonce]') as HTMLScriptElement;\n__webpack_require__.nc = script['nonce'] || script.getAttribute('nonce');\n\nOC.Plugins.register('OCA.Files.SidebarPreviewManager', new SidebarPreview());\n"],"sourceRoot":""}