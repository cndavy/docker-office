!function(e){function t(t){for(var n,i,o=t[0],s=t[1],a=0,l=[];a<o.length;a++)i=o[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&l.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);l.length;)l.shift()()}var n={},i={2:0},r={2:0};function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(e){var t=[];i[e]?t.push(i[e]):0!==i[e]&&{0:1}[e]&&t.push(i[e]=new Promise((function(t,n){for(var r=e+".styles.css",s=o.p+r,a=document.getElementsByTagName("link"),l=0;l<a.length;l++){var c=(d=a[l]).getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(c===r||c===s))return t()}var u=document.getElementsByTagName("style");for(l=0;l<u.length;l++){var d;if((c=(d=u[l]).getAttribute("data-href"))===r||c===s)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var r=t&&t.target&&t.target.src||s,o=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=r,delete i[e],h.parentNode.removeChild(h),n(o)},h.href=s,document.getElementsByTagName("head")[0].appendChild(h)})).then((function(){i[e]=0})));var n=r[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=s);var a,l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=function(e){return o.p+""+e+".editor.js"}(e);var c=new Error;a=function(t){l.onerror=l.onload=null,clearTimeout(u);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",c.name="ChunkLoadError",c.type=i,c.request=o,n[1](c)}r[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:l})}),12e4);l.onerror=l.onload=a,document.head.appendChild(l)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonpMarkdown2=window.webpackJsonpMarkdown2||[],a=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var c=a;o(o.s=0)}([function(e,t,n){"use strict";function i(e,t,n,i){var r,o=!1,s=0;function a(){r&&clearTimeout(r)}function l(){var l=this,c=Date.now()-s,u=arguments;function d(){s=Date.now(),n.apply(l,u)}o||(i&&!r&&d(),a(),void 0===i&&c>e?d():!0!==t&&(r=setTimeout(i?function(){r=void 0}:d,void 0===i?e-c:e)))}return"boolean"!=typeof t&&(i=n,n=t,t=void 0),l.cancel=function(){a(),o=!0},l}n.r(t);var r=function(){function e(){this.initialized=!1,this.listeners=[]}return e.prototype.listenForPaste=function(){var e=this;window.addEventListener("paste",(function(t){e.pasteHandler(t)}))},e.prototype.init=function(){this.initialized||(this.listenForPaste(),this.initialized=!0)},e.prototype.pasteHandler=function(e){if(e.clipboardData&&e.clipboardData.items)for(var t=e.clipboardData.items,n=0;n<t.length;n++)if(t[n].type.includes("image")){var i=t[n].getAsFile(),r=this.getURLObj().createObjectURL(i);this.createImage(r,i)}},e.prototype.getURLObj=function(){return window.URL||window.webkitURL},e.prototype.createImage=function(e,t){var n=this,i=new Image;i.onload=function(){for(var e=0,r=n.listeners;e<r.length;e++){(0,r[e])(i,t)}},i.src=e},e.prototype.listen=function(e){this.init(),this.listeners.push(e)},e}(),o=3,s=function(){function e(){var e,t,n,r=this;this.initPromise=null,this.offsetMap=[],this.scrollMode=null,this.preview=i(500,(function(e,t){r.initAceHooks(),r.initPreviewHooks(t),window.onpopstate=r.onHashChange,r.init().then((function(){r.renderer.renderText(e,t).then((function(){setTimeout((function(){r.buildOffsetMap(t)}),500)}))}))})),this.buildOffsetMap=i(1e3,(function(e){var t=e.offset().top,n=[];e.find("[data-line]").each((function(){n[parseInt(this.dataset.line,10)]=$(this).offset().top-t})),r.offsetMap=n})),this.onScrollEditor=i(100,(function(e){if("preview"!==r.scrollMode){r.scrollMode="editor";var t=Math.max(0,Math.floor(e/15)-o),n=r.offsetMap.find((function(e,n){return void 0!==e&&n>=t}));void 0!==n&&$("#preview").scrollTop(n),r.resetScrollMode()}})),this.onScrollPreview=i(100,(function(){if("editor"!==r.scrollMode){r.scrollMode="preview";var e=r.previewElement.scrollTop(),t=r.offsetMap.findIndex((function(t){return t>=e-1}));t<r.session.getLength()&&aceEditor.scrollToLine(Math.max(t-o,0),!1,!0,(function(){})),r.resetScrollMode()}})),this.resetScrollMode=(e=500,t=function(){r.scrollMode=null},void 0===n?i(e,t,!1):i(e,n,!1!==t)),this.handleImage=function(e,t){OC.dialogs.prompt("Enter the name for the image","Upload image",(function(n,i){if(n){var o=e.src,s=aceEditor.getCursorPosition(),a="![uploading...]("+o+")",l="!["+i+"]("+i+")";r.session.insert(s,a),r.uploadImage(i,t).then((function(){r.session.replace(new r.rangeConstructor(s.row,s.column,s.row,s.column+a.length),l)}))}}),!0,"image name")}}return e.prototype.init=function(){var e=this;if(!this.initPromise){this.initPromise=Promise.all([n.e(0),n.e(1)]).then(n.bind(null,786)).then((function(t){var n=t.Renderer;e.renderer=new n}),console.error.bind(console)),this.textEditorOnHashChange||(this.textEditorOnHashChange=window.onpopstate);var t=window.ace.acequire||window.ace.require;this.rangeConstructor=t("ace/range").Range,(new r).listen(this.handleImage)}return this.initPromise},e.prototype.initAceHooks=function(){this.session!==aceEditor.getSession()&&(this.session=aceEditor.getSession(),aceEditor.$blockScrolling=1/0,this.session.on("changeScrollTop",this.onScrollEditor))},e.prototype.initPreviewHooks=function(e){this.previewElement!==e&&(this.previewElement=e,this.previewElement.scroll(this.onScrollPreview),this.initCheckboxHandler(e))},e.prototype.onHashChange=function(e){"editor"!==window.location.hash.substr(1).substr(0,6)&&this.textEditorOnHashChange&&this.textEditorOnHashChange.call(window,e)},e.prototype.initCheckboxHandler=function(e){var t=this.rangeConstructor,n=this.session;e.on("change","input[type=checkbox]",(function(){var e=this.checked,i=this.dataset.line,r=n.getLine(i).indexOf("[")+1;n.replace(new t(i,r,i,r+1),e?"x":" "),n.$wrapData.length=n.doc.getLength()}))},e.prototype.uploadImage=function(e,t){var n=(this.getCurrentPath()+"/"+e).replace(/\/\/+/g,"/"),i=OC.linkToRemote("files"+n),r=new FileReader,o=$.Deferred();return r.onloadend=function(e){r.result&&$.ajax({url:i,processData:!1,data:r.result.toString(),type:"PUT",success:o.resolve.bind(o),error:o.reject.bind(o)})},r.readAsArrayBuffer(t),o.promise()},e.prototype.getCurrentPath=function(){return OCA.Files_Texteditor.file&&OCA.Files_Texteditor.file.dir?OCA.Files_Texteditor.file.dir:OCA.Files.App&&OCA.Files.App.fileList._currentDirectory?OCA.Files.App.fileList._currentDirectory:void 0},e}(),a=function(){function e(){var e=this;this.initPromise=null,this.handlePreview=function(t,n,i,r){var o=(i.parent().width()+50)/(16/9);$.when(e.getFileContent(t.getFullPath()),e.init()).then((function(t){var r=t[0];n.removeClass("icon-loading icon-32"),i.addClass("large"),i.addClass("text");var s=$('<div id="preview" class="text-markdown"/>');e.renderer.renderText(r,s),n.children(".stretcher").remove(),n.append(s),i.css("max-height",o)}),(function(){r()}))}}return e.prototype.init=function(){var e=this;return this.initPromise||(this.initPromise=Promise.all([n.e(0),n.e(1)]).then(n.bind(null,786)).then((function(t){var n=t.Renderer;e.renderer=new n(!0)}))),this.initPromise},e.prototype.attach=function(e){e.addPreviewHandler("text/markdown",this.handlePreview)},e.prototype.getFileContent=function(e){var t=OC.linkToRemoteBase("files"+e);return $.get(t)},e}(),l=function(){function e(){this.initPromise=null}return e.prototype.init=function(){var e=this;return this.initPromise||(this.initPromise=Promise.all([n.e(0),n.e(1)]).then(n.bind(null,786)).then((function(t){var n=t.Renderer;e.renderer=new n(!0)}))),this.initPromise},e.prototype.attach=function(e,t){var n=this;e.addClass("icon-loading").children().remove(),$.when(this.getFileContent(t),this.init()).then((function(t){var i=t[0];e.removeClass("icon-loading"),n.renderer.renderText(i,e)}))},e.prototype.getFileContent=function(e){var t=OC.generateUrl("/s/{token}/download",{token:e});return $.get(t)},e}(),c=new s;$((function(){if(OCA.Files_Texteditor&&OCA.Files_Texteditor.registerPreviewPlugin&&OCA.Files_Texteditor.registerPreviewPlugin("text/markdown",c),$("#isPublic").val()&&"text/markdown"===$("#mimetype").val()){var e=new l,t=$("#preview");t.addClass("text-markdown");var n=$('<div class="public-preview"/>');t.prepend(n),e.attach(n,$("#sharingToken").val())}})),n.p=OC.filePath("files_markdown","js","../build/");var u=document.querySelector("[nonce]");n.nc=u.nonce||u.getAttribute("nonce"),OC.Plugins.register("OCA.Files.SidebarPreviewManager",new a)}]);
//# sourceMappingURL=editor.js.map